/* Created by Perspecta http://www.perspecta.com */
/*
(c) 2017-2019 Perspecta

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
package com.healthconcourse.vista.fhir.api.test.parser;

import com.healthconcourse.vista.fhir.api.parser.ProcedureParser;
import org.hl7.fhir.dstu3.model.Procedure;
import org.junit.Assert;
import org.junit.Test;
import java.util.List;

public class ProcedureParserTest {

    @Test
    public void TestSuccesfulProcedureParse() {
        String input = "5000000352V586511^10431008|Neuroplasty of median nerve at carpal tunnel|64721|20140803|442_130_10114^19780006|Debridement of Infection of Skin|11000|20100304|442_130_10110";

        ProcedureParser parser = new ProcedureParser();

        List<Procedure> result = parser.parseList(input);

        Assert.assertEquals("Correct number of items", 2, result.size());
    }

    @Test
    public void TestProcedureParseBlankInput() {
        String input = "";

        ProcedureParser parser = new ProcedureParser();

        List<Procedure> result = parser.parseList(input);

        Assert.assertEquals("Correct number of items", 0, result.size());
    }

    @Test
    public void TestProcedureParseNullInput() {

        ProcedureParser parser = new ProcedureParser();

        List<Procedure> result = parser.parseList(null);

        Assert.assertEquals("Correct number of items", 0, result.size());
    }

    @Test
    public void TestProcedureParseIcnOnly() {
        String input = "5000000325V783252";

        ProcedureParser parser = new ProcedureParser();

        List<Procedure> result = parser.parseList(input);

        Assert.assertEquals("Correct number of items", 0, result.size());
    }

    @Test
    public void TestSuccesfulUpdatedProcedureParse() {
        String input = "5000000107V310212^|LABOTAMY||19940913|V_500_130_64^|TEST||19940915|V_500_130_67^56241004|BONE MARROW BIOPSY AND ASPIRATE|20225|19941004|V_500_130_79^|VERICOSE VEINS|01520|19941031|V_500_130_85^|CARPEL TUNNEL|29848|19941115|V_500_130_87^10431008|CARPEL TUNNEL|64721|19941115|V_500_130_88^|TEST||19941115|V_500_130_89^|ASSAY OF CREATININE|82565|199610281138-0500|V_500_9000010.18_97^|ASSAY OF MAGNESIUM|83735|19961127100046-0500|V_500_9000010.18_131^|ASSAY OF AMYLASE|82150|19961209113329-0500|V_500_9000010.18_140^|ASSAY GLUCOSE BLOOD QUANT|82947|199612091139-0500|V_500_9000010.18_141^|ASSAY OF GENTAMICIN|80170|19970109105955-0500|V_500_9000010.18_198^|ASSAY GLUCOSE BLOOD QUANT|82947|19970109111141-0500|V_500_9000010.18_200^|AUTOMATED HEMOGRAM|85024|19970318104113-0500|V_500_9000010.18_261^|LIPID PANEL|80061|19970806141514-0500|V_500_9000010.18_372^|ASSAY OF AMYLASE|82150|19970806141514-0500|V_500_9000010.18_373^|CLINICAL CHEMISTRY TEST|84999|19970806141514-0500|V_500_9000010.18_374^|AUTOMATED HEMOGRAM|85024|19970806141726-0500|V_500_9000010.18_376^|CLINICAL CHEMISTRY TEST|84999|19970904155118-0500|V_500_9000010.18_409^|ASSAY OF AMYLASE|82150|19970904155118-0500|V_500_9000010.18_410^|PATHOLOGY LAB PROCEDURE|89399|19970904155118-0500|V_500_9000010.18_411^|ASSAY OF CALCIUM|82310|19970904155118-0500|V_500_9000010.18_412^|GLUCOSE TEST|82950|19970915114739-0500|V_500_9000010.18_427^|ASSAY OF AMYLASE|82150|19970915115049-0500|V_500_9000010.18_428^|ASSAY OF MAGNESIUM|83735|19970915115049-0500|V_500_9000010.18_429^|ASSAY OF AMYLASE|82150|19970915115508-0500|V_500_9000010.18_430^|PATHOLOGY LAB PROCEDURE|89399|19970915115508-0500|V_500_9000010.18_431^|GLUCOSE TEST|82950|19970915115508-0500|V_500_9000010.18_432^|ASSAY OF CALCIUM|82310|19970915115508-0500|V_500_9000010.18_433^|MICROBIOLOGY PROCEDURE|87999|19970918133438-0500|V_500_9000010.18_463^|MICROBIOLOGY PROCEDURE|87999|19970918152626-0500|V_500_9000010.18_464^|MICROBIOLOGY PROCEDURE|87999|19970918152752-0500|V_500_9000010.18_465^|GLUCOSE TEST|82950|19970919113344-0500|V_500_9000010.18_466^|GLUCOSE TEST|82950|19970919113418-0500|V_500_9000010.18_467^|GLUCOSE TEST|82950|19970919113435-0500|V_500_9000010.18_468^|THROMBIN TIME PLASMA|85670|19971017084121-0500|V_500_9000010.18_498^|PROTHROMBIN TIME|85610|19971017084121-0500|V_500_9000010.18_499^|GLUCOSE TEST|82950|19971017090517-0500|V_500_9000010.18_503^|CLINICAL CHEMISTRY TEST|84999|19971219112938-0500|V_500_9000010.18_643^|CLINICAL CHEMISTRY TEST|84999|19971219114515-0500|V_500_9000010.18_644^|CLINICAL CHEMISTRY TEST|84999|19971219114515-0500|V_500_9000010.18_645^|ECHO EXAMINATION PROCEDURE|76999|19980126151658-0500|V_500_9000010.18_691^|AUTOMATED HEMOGRAM|85024|19980129111648-0500|V_500_9000010.18_696^|AUTOMATED HEMOGRAM|85024|19980129113213-0500|V_500_9000010.18_697^|AUTOMATED HEMOGRAM|85024|19980226085120-0500|V_500_9000010.18_741^|BLOOD SMEAR INTERPRETATION|85060|19980226085120-0500|V_500_9000010.18_742^|AUTOMATED HEMOGRAM|85024|19980302090740-0500|V_500_9000010.18_757^|BLOOD SMEAR INTERPRETATION|85060|19980302090740-0500|V_500_9000010.18_758^|GLUCOSE TEST|82950|199808311440-0500|V_500_9000010.18_841^|ASSAY OF AMYLASE|82150|199808311440-0500|V_500_9000010.18_842^|AUTOMATED HEMOGRAM|85024|19981002123522-0500|V_500_9000010.18_872^|BLOOD SMEAR INTERPRETATION|85060|19981002123522-0500|V_500_9000010.18_873^|AUTOMATED HEMOGRAM|85024|19981005114831-0500|V_500_9000010.18_874^|BLOOD SMEAR INTERPRETATION|85060|19981005114831-0500|V_500_9000010.18_875^|LIPID PANEL|80061|19981007090251-0500|V_500_9000010.18_882^|THROMBIN TIME PLASMA|85670|19981013135013-0500|V_500_9000010.18_884^|PROTHROMBIN TIME|85610|19981013135013-0500|V_500_9000010.18_885^|ASSAY OF CALCIUM|82310|19981021084826-0500|V_500_9000010.18_907^|THROMBIN TIME PLASMA|85670|19981021084834-0500|V_500_9000010.18_908^|PROTHROMBIN TIME|85610|19981021084834-0500|V_500_9000010.18_909^|ASSAY THYROID STIM HORMONE|84443|19981022104949-0500|V_500_9000010.18_915^|VITAMIN B-12|82607|19981022104949-0500|V_500_9000010.18_916^|GLUCOSE TEST|82950|19981105150103-0500|V_500_9000010.18_947^|ASSAY OF CALCIUM|82310|19981123092027-0500|V_500_9000010.18_960^|ASSAY OF CALCIUM|82310|19981123092125-0500|V_500_9000010.18_961^|ASSAY OF CALCIUM|82310|19981123092235-0500|V_500_9000010.18_962^|ASSAY OF CALCIUM|82310|19981123093735-0500|V_500_9000010.18_963^|ASSAY OF CALCIUM|82310|199811230937-0500|V_500_9000010.18_964^|ASSAY OF CALCIUM|82310|19981124112750-0500|V_500_9000010.18_965^|CLINICAL CHEMISTRY TEST|84999|19981218105628-0500|V_500_9000010.18_1026^|AUTOMATED HEMOGRAM|85024|19981218105630-0500|V_500_9000010.18_1027^|THROMBIN TIME PLASMA|85670|19981218105630-0500|V_500_9000010.18_1028^|PROTHROMBIN TIME|85610|19981218105630-0500|V_500_9000010.18_1029^|URINALYSIS AUTO W/SCOPE|81001|19981218105630-0500|V_500_9000010.18_1030^|MICROBIOLOGY PROCEDURE|87999|19981218105631-0500|V_500_9000010.18_1031^71388002|MAMMOGRAM BILAT|77056|199812010911-0500|V_500_70_210_7018798.9088_1^|FOOT 2 VIEWS|73620|199811021113-0500|V_500_70_210_7018897.8886_1^|ANGIO PULMONARY UNILAT SELECT S&I|75741|199703190902-0500|V_500_70_210_7029680.9097_1^|ANKLE 2 VIEWS|73600|199702130800-0500|V_500_70_210_7029786.9199_1^|CHEST SINGLE VIEW|71010|199612171410-0500|V_500_70_210_7038782.8589_1^|ANKLE 2 VIEWS|73600|199612161616-0500|V_500_70_210_7038783.8383_1";

        ProcedureParser parser = new ProcedureParser();

        List<Procedure> result = parser.parseList(input);

        Assert.assertEquals("Correct number of items", 81, result.size());
    }
}
